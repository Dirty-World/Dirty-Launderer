[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![CI Build](https://github.com/the-dirty-launderer/dirty-launderer/actions/workflows/python-tests.yml/badge.svg)](https://github.com/the-dirty-launderer/dirty-launderer/actions/workflows/python-tests.yml)
[![Docs](https://img.shields.io/badge/docs-GitHub%20Pages-blue)](https://the-dirty-launderer.github.io/dirty-launderer)
[![Version](https://img.shields.io/badge/version-1.0.0-blue)](#)

# Dirty Launderer ğŸ§¼

![a3ca62e7-0fc7-4a3b-bfd7-a861dde5df88](https://github.com/user-attachments/assets/9ba31cb1-75c4-4198-9222-48476874cd87)

ğŸ’ƒ *A lady in the streets, and clean in the sheetsâ€¦ of tracking parameters.* ğŸ§¼

A privacy-first Telegram bot that automatically cleans tracking parameters from URLs, and proxies uncleanable links using services like Invidious, Nitter, Libreddit, and more.

## ğŸ”§ Features

- Auto-cleans URLs from common trackers
- Supports proxying via privacy frontends
- Fully admin-configurable via Telegram commands
- PII-safe logging to Google Cloud Logging
- Modular domain handler design
- Cloud Functions + Firestore + GitHub Actions

## ğŸ“¦ Repo Structure

```
dirty-launderer/
â”œâ”€â”€ bot/                  # Telegram bot source code
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ admin/           # Admin command handlers
â”‚   â”œâ”€â”€ handlers/        # Domain-specific link handlers
â”‚   â”œâ”€â”€ utils/           # Firestore + proxy helpers
â”œâ”€â”€ dist/                # Deployment ZIP (autogenerated)
â”œâ”€â”€ post_apply.sh        # Optional webhook registrar
â”œâ”€â”€ .github/workflows/   # GitHub Actions
â”‚   â””â”€â”€ deploy.yml
â”œâ”€â”€ README.md
```

> ğŸ“ **Note**: Infrastructure code (Terraform) has been moved to a [separate repository](https://github.com/Dirty-World/dirty-launderer-infra) for better maintainability and security.

## ğŸš€ Deployment

1. **Add secrets to GitHub**:
    - `GCP_CREDENTIALS`
    - `GCP_PROJECT_ID`
    - `TELEGRAM_BOT_TOKEN`
    - `ADMIN_CHAT_ID`
    - `GCS_BUCKET_NAME`

2. **Push to main branch** â†’ GitHub Actions will:
    - Zip bot/
    - Upload to GCS
    - Trigger infrastructure deployment

3. **Webhook is auto-registered via post_apply.sh or Cloud Function**

## ğŸ¤– Telegram Commands

Run `/setcommands` in BotFather and paste:

```
setdomain - Set handling for a specific domain
listdomains - View all domain rules
resetdomains - Reset domain settings to default
setdefault - Set default behavior for unknown domains
setlogging - Enable or disable safe logging
showlogging - View current logging mode
previewdomain - Preview handling for a domain
tools - Show admin tools
welcome - Show welcome/help message
ping - Check if the bot is running and webhook is healthy
alerttest - Test an admin alert
status - Check bot status and webhook info
proxies - Show count of active proxy frontends
configsummary - Show this group's domain config
commands - Show a full list of bot commands
```

## ğŸ’¬ Credits

Made by [you], deployed serverlessly on GCP.

# Dirty Launderer Infrastructure ğŸ—ï¸

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

This repository contains the infrastructure as code (IaC) for the [Dirty Launderer](https://github.com/Dirty-World/dirty-launderer) project. It uses Terraform to manage cloud resources on Google Cloud Platform.

## ğŸ›ï¸ Architecture

The infrastructure consists of:
- Google Cloud Functions for the bot
- Cloud Firestore for state management
- Cloud Scheduler for health checks
- IAM roles and service accounts
- Cloud Monitoring and Logging
- GitHub Actions integration

## ğŸ“ Repository Structure

```
terraform/
â”œâ”€â”€ bootstrap/           # Bootstrap configuration
â”‚   â”œâ”€â”€ main.tf         # Initial setup (GCS, service accounts)
â”‚   â”œâ”€â”€ outputs.tf      # Bootstrap outputs
â”‚   â””â”€â”€ variables.tf    # Bootstrap variables
â”œâ”€â”€ main.tf             # Main infrastructure
â”œâ”€â”€ apis.tf             # Required GCP APIs
â”œâ”€â”€ budget.tf           # Cost management
â”œâ”€â”€ github.tf           # GitHub integration
â”œâ”€â”€ variables.tf        # Common variables
â””â”€â”€ tests/              # Infrastructure tests
```

## ğŸš€ Prerequisites

- Terraform >= 1.0.0
- Google Cloud SDK
- Access to the GCP project
- GitHub repository access

## ğŸ› ï¸ Setup

1. Install required tools:
   ```bash
   # Install Terraform
   choco install terraform    # Windows
   brew install terraform     # macOS
   
   # Install Google Cloud SDK
   # Follow: https://cloud.google.com/sdk/docs/install
   ```

2. Authenticate with Google Cloud:
   ```bash
   gcloud auth application-default login
   ```

3. Initialize Terraform:
   ```bash
   cd terraform
   terraform init
   ```

## ğŸ¯ Usage

1. Plan changes:
   ```bash
   terraform plan
   ```

2. Apply changes:
   ```bash
   terraform apply
   ```

3. Run tests:
   ```bash
   cd tests
   python -m pytest test_infrastructure.py
   ```

## âš™ï¸ Configuration

Key configuration files:
- `terraform.tfvars` - Environment-specific values
- `variables.tf` - Variable definitions
- `.terraform.lock.hcl` - Provider version locks

## ğŸ”’ Security Notes

- State files are stored remotely in GCS bucket
- Sensitive values should be passed via GitHub Secrets
- Use workspaces for different environments
- Follow least privilege principle for IAM roles

## ğŸ¤ Contributing

1. Create a new branch
2. Make your changes
3. Run `terraform fmt` and `terraform validate`
4. Run the test suite
5. Submit a pull request

## ğŸ“ Important Notes

- Always review the plan before applying changes
- Use workspaces for different environments if needed
- Run `terraform fmt` before committing changes
- Keep provider versions locked
- Monitor costs via budget alerts
