[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![CI Build](https://github.com/the-dirty-launderer/dirty-launderer/actions/workflows/python-tests.yml/badge.svg)](https://github.com/the-dirty-launderer/dirty-launderer/actions/workflows/python-tests.yml)
[![Docs](https://img.shields.io/badge/docs-GitHub%20Pages-blue)](https://the-dirty-launderer.github.io/dirty-launderer)
[![Version](https://img.shields.io/badge/version-1.0.0-blue)](#)

# Dirty Launderer 🧼

![a3ca62e7-0fc7-4a3b-bfd7-a861dde5df88](https://github.com/user-attachments/assets/9ba31cb1-75c4-4198-9222-48476874cd87)

💃 *A lady in the streets, and clean in the sheets… of tracking parameters.* 🧼

A privacy-first Telegram bot that automatically cleans tracking parameters from URLs, and proxies uncleanable links using services like Invidious, Nitter, Libreddit, and more.

## 🔧 Features

- Auto-cleans URLs from common trackers
- Supports proxying via privacy frontends
- Fully admin-configurable via Telegram commands
- PII-safe logging to Google Cloud Logging
- Modular domain handler design
- Cloud Functions + Firestore + GitHub Actions

## 📦 Repo Structure

```
dirty-launderer/
├── bot/                  # Telegram bot source code
│   ├── main.py
│   ├── admin/           # Admin command handlers
│   ├── handlers/        # Domain-specific link handlers
│   ├── utils/           # Firestore + proxy helpers
├── dist/                # Deployment ZIP (autogenerated)
├── post_apply.sh        # Optional webhook registrar
├── .github/workflows/   # GitHub Actions
│   └── deploy.yml
├── README.md
```

> 📝 **Note**: Infrastructure code (Terraform) has been moved to a [separate repository](https://github.com/Dirty-World/dirty-launderer-infra) for better maintainability and security.

## 🚀 Deployment

1. **Add secrets to GitHub**:
    - `GCP_CREDENTIALS`
    - `GCP_PROJECT_ID`
    - `TELEGRAM_BOT_TOKEN`
    - `ADMIN_CHAT_ID`
    - `GCS_BUCKET_NAME`

2. **Push to main branch** → GitHub Actions will:
    - Zip bot/
    - Upload to GCS
    - Trigger infrastructure deployment

3. **Webhook is auto-registered via post_apply.sh or Cloud Function**

## 🤖 Telegram Commands

Run `/setcommands` in BotFather and paste:

```
setdomain - Set handling for a specific domain
listdomains - View all domain rules
resetdomains - Reset domain settings to default
setdefault - Set default behavior for unknown domains
setlogging - Enable or disable safe logging
showlogging - View current logging mode
previewdomain - Preview handling for a domain
tools - Show admin tools
welcome - Show welcome/help message
ping - Check if the bot is running and webhook is healthy
alerttest - Test an admin alert
status - Check bot status and webhook info
proxies - Show count of active proxy frontends
configsummary - Show this group's domain config
commands - Show a full list of bot commands
```

## 💬 Credits

Made by [you], deployed serverlessly on GCP.

# Dirty Launderer Infrastructure 🏗️

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

This repository contains the infrastructure as code (IaC) for the [Dirty Launderer](https://github.com/Dirty-World/dirty-launderer) project. It uses Terraform to manage cloud resources on Google Cloud Platform.

## 🏛️ Architecture

The infrastructure consists of:
- Google Cloud Functions for the bot
- Cloud Firestore for state management
- Cloud Scheduler for health checks
- IAM roles and service accounts
- Cloud Monitoring and Logging
- GitHub Actions integration

## 📁 Repository Structure

```
terraform/
├── bootstrap/           # Bootstrap configuration
│   ├── main.tf         # Initial setup (GCS, service accounts)
│   ├── outputs.tf      # Bootstrap outputs
│   └── variables.tf    # Bootstrap variables
├── main.tf             # Main infrastructure
├── apis.tf             # Required GCP APIs
├── budget.tf           # Cost management
├── github.tf           # GitHub integration
├── variables.tf        # Common variables
└── tests/              # Infrastructure tests
```

## 🚀 Prerequisites

- Terraform >= 1.0.0
- Google Cloud SDK
- Access to the GCP project
- GitHub repository access

## 🛠️ Setup

1. Install required tools:
   ```bash
   # Install Terraform
   choco install terraform    # Windows
   brew install terraform     # macOS
   
   # Install Google Cloud SDK
   # Follow: https://cloud.google.com/sdk/docs/install
   ```

2. Authenticate with Google Cloud:
   ```bash
   gcloud auth application-default login
   ```

3. Initialize Terraform:
   ```bash
   cd terraform
   terraform init
   ```

## 🎯 Usage

1. Plan changes:
   ```bash
   terraform plan
   ```

2. Apply changes:
   ```bash
   terraform apply
   ```

3. Run tests:
   ```bash
   cd tests
   python -m pytest test_infrastructure.py
   ```

## ⚙️ Configuration

Key configuration files:
- `terraform.tfvars` - Environment-specific values
- `variables.tf` - Variable definitions
- `.terraform.lock.hcl` - Provider version locks

## 🔒 Security Notes

- State files are stored remotely in GCS bucket
- Sensitive values should be passed via GitHub Secrets
- Use workspaces for different environments
- Follow least privilege principle for IAM roles

## 🤝 Contributing

1. Create a new branch
2. Make your changes
3. Run `terraform fmt` and `terraform validate`
4. Run the test suite
5. Submit a pull request

## 📝 Important Notes

- Always review the plan before applying changes
- Use workspaces for different environments if needed
- Run `terraform fmt` before committing changes
- Keep provider versions locked
- Monitor costs via budget alerts
